### L2D - Learning to Delegate

```shell
./
├── code              # source code
├── exps              # pretrained model (checkpoint)
├── generations       # training/test dataset
```

#### 1. Meta-learning implementation: 

Please ref to `supervised_maml.py`

*Note: we do not implement the task scheduler since the data generation process in L2D is not flexible as POMO.*

*Note: based on our exps, the training of the first-order approximation is not stable in L2D. Nevertheless, unlike POMO, the second-order one for L2D is computationally efficient.*

#### 2. How to run? 

Please ref to https://github.com/mit-wu-lab/learning-to-delegate for the full instructions.

**Setups:** We train a regression model since (1) it has a better training efficiency (around 6 hrs) compared to the classification model; (2) it has better flexibility in training multiple sizes and distributions, which is quite suitable for the meta-learning setting. We use the datasets provided by the authors of L2D to construct the training task set. Concretely, the training task set contains six mixed CVRP distributions with $N\in$ {500, 1000} x $D \in$ {3,5,7}, where N is the problem size and D is the cluster center. We use HGS as the subsolver and keep the other settings the same as L2D. During the evaluation, we set the number of runs to 1 for each instance and set the time limit for solving each subproblem to 1s. For a fair comparison, we retrain the regression model (L2D with batch size 512 and 2048) and meta-train a regression model (Ours with batch size 512) on our training task set. We show the average cost over 10 instances in each test dataset (provided by the authors).

#### 3. Running command for size N=1000:

```shell
! MKL_NUM_THREADS=1 python supervised.py generations/mixed_merge/subproblem_selection_hgs/ exps/regression_model --generate --step 40000 --generate_partition test --save_dir generations/mixed_nc3_N1000 --save_suffix _test --generate_depth 600 --generate_index_start 0 --generate_index_end 10 --time_threshold 1 --n_trajectories 1 --n_cpus 5 --device cpu --solver HGS --data_suffix ""
```

#### 4. Full results:

```shell
mixed_nc3_N1000 - l2d(512)
[251.62551106502104, 53.57689983460714, 28.56822744543322, 166.9091070088698, 91.15954761906055, 170.48554992760728, 162.57677161432514, 129.81172138505744, 217.05214095248624, 153.577202052794]

mixed_nc3_N1000 - l2d(2048)
[84.7261170488263, 154.47144959719782, 83.69741048932549, 132.55254007655012, 218.25089110261925, 90.82448688068173, 150.43330142172704, 64.05975205820026, 173.92140200474418, 256.09531748297223]

mixed_nc3_N1000 - ours
[69.42047071444838, 51.0427442793504, 97.65782295711232, 104.50522717224759, 153.83061643063832, 42.17797180672912, 79.05410121573252, 119.54723134578701, 36.725955585189745, 55.51555610691494]



mixed_nc5_N1000 - l2d(512)
[69.74019808224472, 145.62450211310988, 169.72627323642416, 175.68106323374602, 157.3990536080209, 140.5325179742928, 82.34193183291808, 134.56869159571897, 55.80117246607038, 61.89810510360775]

mixed_nc5_N1000 - l2d(2048)
[110.72574893288841, 210.50907757356333, 184.88189880567415, 137.9578037311125, 192.99076090600752, 160.20049773022308, 57.41022826327845, 195.1705199857107, 163.49641411392273, 202.78750286094393]

mixed_nc5_N1000 - ours
[57.99501089117571, 93.34225822425061, 23.893524686932167, 177.03256662708472, 81.19762216863502, 100.40882459729039, 80.0493212122108, 144.23420107087776, 53.01993327542823, 144.12822490612234]



mixed_nc7_N1000 - l2d(512)
[84.62617227541953, 157.64712536068947, 128.03225841148753, 111.38248097396769, 59.74387879033938, 63.97868835936334, 114.86516268704834, 77.3905800445684, 112.78580207952513, 119.14617272509064]

mixed_nc7_N1000 - l2d(2048)
[135.89377747817426, 296.5332504141086, 278.9569668944009, 117.70339047152336, 232.70333555461082, 136.15778021436194, 64.44752992501857, 174.37551994169954, 253.02258379140608, 399.67403791328377]

mixed_nc7_N1000 - ours
[140.32011966077465, 292.97712925488884, 47.40998068710085, 39.58978814873822, 136.05281145567835, 56.59073682903006, 152.6357394237988, 63.939639374008316, 149.9488242006247, 170.02422984660086]



cluster_nc3_1000 - l2d(512)
[30.120461218524323, 150.4278131780203, 117.15000206739259, 42.32548831592055, 205.21742728318816, 250.7096387226733, 67.85091837340616, 127.59407470084068, 241.11326376547004, 261.83017371705233]

cluster_nc3_1000 - l2d(2048)
[171.7667802125586, 47.84423728470563, 77.10981619124246, 47.45477736388848, 129.16827534800174, 39.310031232815525, 12.145358431531388, 134.87052455643556, 109.25089985635734, 43.20389513123844]

cluster_nc3_1000 - ours
[58.656071567009434, 41.92006968030428, 49.618833336973864, 81.95952442043318, 166.16650047935875, 266.65154333726207, 51.09558283707406, 34.58893279238909, 58.64886438014483, 110.2826485745973]



Running Command for size N=2000:
! MKL_NUM_THREADS=1 python supervised.py generations/mixed_merge/subproblem_selection_hgs/ exps/regression_model --generate --step 40000 --generate_partition test --save_dir generations/mixed_nc3_N2000 --save_suffix _test --generate_depth 1200 --generate_index_start 0 --generate_index_end 10 --time_threshold 1 --n_trajectories 1 --n_cpus 5 --device cpu --solver HGS --data_suffix ""

mixed_nc3_N2000 - l2d(512)
[297.17555995646046, 224.1117641739214, 323.6044628226989, 603.002817128388, 86.74928776573856, 31.01868685831254, 249.67777303587462, 235.97461509991484, 222.13176661809973, 603.002817128388]

mixed_nc3_N2000 - l2d(2048)
[587.184820767217, 210.7612750888125, 75.38392770167391, 520.371185956098, 304.69808997879454, 252.4886658906179, 188.74746698222876, 499.0123259666653, 238.5963423825351, 243.42672266328546]

mixed_nc3_N2000 - ours
[166.38890659919699, 14.473578857181273, 56.02676363673076, 102.7478707574481, 269.31974708922655, 65.79044088651204, 121.26241497652829, 58.73771721324477, 54.156602636351344, 103.84752849939254]



mixed_nc5_N2000 - l2d(512)
[336.05504129618356, 305.35381922008713, 545.7554339182415, 31.107871095495945, 15.412486810713151, 377.00637798927505, 228.69223396604536, 181.2950498462646, 139.77915218755012, 295.05411923606533]

mixed_nc5_N2000 - l2d(2048)
[120.18143415266007, 239.50822722280745, 395.9750986602888, 231.17618970855347, 123.9906443227357, 61.886272600207526, 63.21917965150509, 306.3240563321283, 268.02123944893873, 138.08266388635508]

mixed_nc5_N2000 - ours
[169.22787904589654, 15.25169628958133, 183.63330947438064, 44.88655876991325, 203.14387332737172, 164.50153655549016, 52.84231699778137, 321.23316840142826, 49.347673589059355, 190.37120468174933]



mixed_nc7_N2000 - l2d(512)
[58.41117336948586, 162.38480853630307, 20.173872809889595, 284.8120501912994, 252.75855695353138, 407.1377845829606, 243.13406959016777, 118.38687248195713, 283.9189665950691, 187.23938054255234]

mixed_nc7_N2000 - l2d(2048)
[274.059016924158, 341.0806826295227, 257.68884597770165, 440.3634987968597, 347.35328305574257, 298.4314865476653, 292.16630394701144, 172.3322990292549, 402.508525286955, 178.39174662542698]

mixed_nc7_N2000 - ours
[39.02544223359225, 95.01056393060658, 159.83643251882305, 123.78308760692866, 207.52486457330627, 126.03625945016063, 45.65872605374195, 22.730502604456245, 96.75671104917379, 43.97014364418021]



cluster_nc3_2000 - l2d(512)
[563.2109033353247, 104.06906492981103, 244.64043763420003, 206.17920183959623, 89.24705936199747, 128.66908520327183, 147.56376484351892, 180.53860000617067, 137.05012740969215, 145.8099772676529]

cluster_nc3_2000 - l2d(2048)
[385.5637432105201, 277.29559212692345, 92.46191472292881, 426.25341582036725, 180.45819685366106, 240.1705485484613, 389.27261295285996, 275.3181096552707, 140.05090556334272, 245.7650284797365]

cluster_nc3_2000 - ours
[166.2742823513385, 10.246224912987316, 120.88454563307403, 63.16772656055168, 93.23240030367036, 99.73175989491011, 200.17958806832718, 111.87716161302477, 32.97521295307001, 73.30037148228023]
```

